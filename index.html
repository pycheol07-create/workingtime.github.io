<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:,">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¼ë¥˜íŒ€ ì—…ë¬´í˜„í™©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="toast-container" class="fixed bottom-5 right-5 z-[200] space-y-2 w-full max-w-xs"></div>

    <div id="app-content" class="w-full min-h-screen bg-white p-6 md:p-8 flex flex-col">

        <div class="relative">
            <div class="flex justify-between items-center md:hidden mb-4 pt-4">
                <h1 class="text-3xl font-bold text-gray-900">ë¬¼ë¥˜íŒ€ ì—…ë¬´í˜„í™©</h1>
                <button id="hamburger-btn" class="p-2 rounded-md text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>

            <div id="nav-content"
                 class="hidden md:flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-2 w-full
                        absolute md:relative top-20 md:top-auto left-0 md:left-auto right-0 md:right-auto
                        bg-white md:bg-transparent shadow-lg md:shadow-none z-40 p-4 md:p-0 rounded-lg md:rounded-none border md:border-none">

                <div id="current-date-display" class="text-lg font-bold text-gray-700 hidden md:text-lg md:mr-auto"></div>

                <div id="top-right-controls" class="flex flex-col items-start md:items-end gap-2 hidden">
                    <div id="connection-indicator" class="flex items-center gap-2">
                        <span id="user-greeting" class="text-sm font-semibold text-gray-700 mr-2 hidden"></span>
                        <span id="status-dot" class="w-2.5 h-2.5 rounded-full bg-gray-400"></span>
                        <span id="connection-status" class="text-xs font-medium text-gray-500"></span>
                    </div>
                    
                    <div class="hidden md:flex items-center gap-3">
                        <div id="personal-attendance-toggle-pc" class="hidden items-center gap-2 mr-2">
                            <span class="text-sm font-semibold text-gray-700" id="pc-attendance-label">ë‚´ ê·¼íƒœ:</span>
                            <label class="attendance-toggle">
                                <input type="checkbox" id="pc-attendance-checkbox" class="sr-only peer">
                                <span class="attendance-toggle-text text-in">ì¶œê·¼</span>
                                <span class="attendance-toggle-text text-out">í‡´ê·¼</span>
                                <span class="attendance-toggle-knob"></span>
                            </label>
                            <button id="pc-clock-out-cancel-btn" class="hidden text-xs bg-yellow-100 hover:bg-yellow-200 text-yellow-800 font-medium px-2 py-1 rounded-md transition animate-pulse" title="ë°©ê¸ˆ í•œ í‡´ê·¼ì„ ì·¨ì†Œí•˜ê³  ë‹¤ì‹œ ê·¼ë¬´ ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.">
                                í‡´ê·¼ ì·¨ì†Œ
                            </button>
                        </div>

                        <div class="relative hidden md:block">
                            <button id="menu-toggle-btn" class="flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm transition active:scale-[0.98]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                                <span>ë©”ë‰´</span>
                            </button>
                            <div id="menu-dropdown" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg border border-gray-200 z-50">
                                <button id="open-quantity-modal-today" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 border-b border-gray-100">
                                    <span>ğŸ“Š</span> <span class="font-medium">ì˜¤ëŠ˜ ì²˜ë¦¬ëŸ‰ ì…ë ¥</span>
                                </button>
                                <button id="open-cost-simulation-btn" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 border-b border-gray-100">
                                    <span>ğŸ’°</span> <span class="font-medium">ìš´ì˜ ì‹œë®¬ë ˆì´ì…˜</span>
                                </button>
                                
                                <button id="open-history-btn" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 border-b border-gray-100" style="display: none;">
                                    <span>ğŸ“œ</span> <span class="font-medium">ì´ë ¥ ë³´ê¸°</span>
                                </button>
                                <button id="end-shift-btn" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 border-b border-gray-100">
                                    <span>ğŸ</span> <span class="font-medium">ì—…ë¬´ ë§ˆê°</span>
                                </button>

                                <a href="admin.html" id="admin-link-btn" target="admin_window" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 border-b border-gray-100" style="display: none;">
                                    <span>âš™ï¸</span> <span class="font-medium">ê´€ë¦¬ì í˜ì´ì§€</span>
                                </a>
                                <button id="reset-app-btn" class="w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 border-b border-gray-100" style="display: none;">
                                    <span>ğŸ”„</span> <span class="font-medium">ì˜¤ëŠ˜ ë°ì´í„° ì´ˆê¸°í™”</span>
                                </button>
                                <button id="logout-btn" class="hidden w-full text-left flex items-center gap-2 px-4 py-3 text-sm text-red-600 hover:bg-red-50 rounded-b-md">
                                    <span>ğŸšª</span> <span class="font-semibold">ë¡œê·¸ì•„ì›ƒ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col items-start gap-2 md:hidden">
                         <div id="personal-attendance-toggle-mobile" class="flex justify-between items-center w-full p-3 bg-white rounded-lg border shadow-sm hidden">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-gray-800 flex items-center gap-2">ë‚´ ì¶œí‡´ê·¼</span>
                                <button id="mobile-clock-out-cancel-btn" class="hidden text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-md">ì·¨ì†Œ</button>
                            </div>
                            <label class="attendance-toggle">
                                <input type="checkbox" id="mobile-attendance-checkbox" class="sr-only peer">
                                <span class="attendance-toggle-text text-in">ì¶œê·¼</span>
                                <span class="attendance-toggle-text text-out">í‡´ê·¼</span>
                                <span class="attendance-toggle-knob"></span>
                            </label>
                        </div>
                        <button id="open-quantity-modal-today-mobile" class="flex items-center gap-2 bg-purple-100 text-purple-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm">
                            <span>ğŸ“Š ì²˜ë¦¬ëŸ‰ ì…ë ¥</span>
                        </button>
                        
                        <button id="open-cost-simulation-btn-mobile" class="flex items-center gap-2 bg-indigo-100 text-indigo-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm">
                            <span>ğŸ’° ìš´ì˜ ì‹œë®¬ë ˆì´ì…˜</span>
                        </button>
                        <button id="open-history-btn-mobile" class="flex items-center gap-2 bg-gray-100 text-gray-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm" style="display: none;">
                            <span>ğŸ“œ ì´ë ¥ ë³´ê¸°</span>
                        </button>
                        <button id="end-shift-btn-mobile" class="flex items-center gap-2 bg-red-100 text-red-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm">
                            <span>ğŸ ì—…ë¬´ ë§ˆê°</span>
                        </button>

                        <a href="admin.html" id="admin-link-btn-mobile" target="admin_window" class="flex items-center gap-2 bg-blue-100 text-blue-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm" style="display: none;">
                            <span>âš™ï¸ ê´€ë¦¬</span>
                        </a>
                        <button id="reset-app-btn-mobile" class="flex items-center gap-2 bg-gray-200 text-gray-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm" style="display: none;">
                            <span>ğŸ”„ ì´ˆê¸°í™”</span>
                        </button>
                        <button id="logout-btn-mobile" class="hidden flex items-center gap-1 bg-red-100 text-red-800 font-semibold text-sm py-1.5 px-3 rounded-md shadow-sm">
                            <span>ğŸšª ë¡œê·¸ì•„ì›ƒ</span>
                        </button>
                    </div>
                </div>
            </div>

            <header class="mb-8 text-center hidden md:block">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900">ë¬¼ë¥˜íŒ€ ì—…ë¬´í˜„í™©</h1>
            </header>
        </div>

        <div class="mb-8 bg-gray-800 text-white rounded-lg border border-gray-700 shadow-lg hidden">
            <div id="toggle-summary" class="flex justify-between items-center p-4 cursor-pointer md:cursor-auto">
                <h2 class="text-xl font-bold">ì—…ë¬´ í˜„í™© ë° ì—…ë¬´ëŸ‰</h2>
                <svg id="summary-arrow" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:hidden transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="summary-content" class="hidden md:grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4 p-6 text-center">
                </div>
        </div>

        <div id="main-content-area" class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200 flex-grow flex flex-col hidden">
            <h2 class="text-xl font-bold text-gray-900 mb-4">ì—…ë¬´ ì§„í–‰</h2>
            <div id="loading-spinner" class="text-center py-10">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                <p class="mt-4 text-gray-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
            <div id="team-status-board" class="space-y-8 flex-grow">
                </div>
        </div>

        <div class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200 hidden">
            <div id="toggle-completed-log" class="flex justify-between items-center cursor-pointer md:cursor-auto">
                <h2 class="text-xl font-bold text-gray-900">ì˜¤ëŠ˜ ì™„ë£Œëœ ì—…ë¬´</h2>
                <svg id="completed-log-arrow" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:hidden transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="completed-log-content" class="hidden md:block mt-4">
                <div class="flex flex-wrap gap-2 justify-end items-center mb-4">
                    <button id="save-progress-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-md">ì¤‘ê°„ ì €ì¥</button>
                </div>
                <div class="overflow-auto relative bg-white rounded-md max-h-96">
                    <table class="w-full text-sm text-left text-gray-600">
                        <thead class="text-xs text-blue-500 uppercase bg-gray-100 sticky top-0 z-10">
                            <tr>
                                <th scope="col" class="px-6 py-3">ì´ë¦„</th>
                                <th scope="col" class="px-6 py-3">ì—…ë¬´</th>
                                <th scope="col" class="px-6 py-3">ì‹œì‘ ì‹œê°„</th>
                                <th scope="col" class="px-6 py-3">ì¢…ë£Œ ì‹œê°„</th>
                                <th scope="col" class="px-6 py-3">ì†Œìš” ì‹œê°„</th>
                                <th scope="col" class="px-6 py-3 text-right">
                                    <button id="open-manual-add-btn" class="text-xs font-bold text-blue-500 uppercase hover:text-blue-700 mr-3">ìˆ˜ë™ ì¶”ê°€</button>
                                    <button id="delete-all-completed-btn" class="text-xs font-bold text-red-500 uppercase hover:text-red-700">ì¼ê´„ì‚­ì œ</button>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="work-log-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="p-6 bg-gray-50 rounded-lg border border-gray-200 hidden">
            <div id="toggle-analysis" class="flex justify-between items-center cursor-pointer md:cursor-auto">
                <h2 class="text-xl font-bold text-gray-900">ì˜¤ëŠ˜ì˜ ì—…ë¬´ ë¶„ì„</h2>
                 <svg id="analysis-arrow" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:hidden transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div id="analysis-content" class="hidden md:block mt-4">
                <div class="mb-4 border-b border-gray-200">
                    <nav id="analysis-tabs" class="flex space-x-4" aria-label="Tabs">
                        <button type="button" data-tab-panel="analysis-task-summary-panel" class="analysis-tab-btn whitespace-nowrap pb-3 px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-600">ì—…ë¬´ë³„ ìš”ì•½</button>
                        <button type="button" data-tab-panel="analysis-personal-stats-panel" class="analysis-tab-btn whitespace-nowrap pb-3 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">ê°œì¸ë³„ í†µê³„</button>
                    </nav>
                </div>
                <div id="analysis-panels">
                    <div id="analysis-task-summary-panel" class="analysis-tab-panel"></div>
                    <div id="analysis-personal-stats-panel" class="analysis-tab-panel hidden">
                        <div class="max-w-md mb-4">
                            <label for="analysis-member-select" class="block text-sm font-medium text-gray-700 mb-1">ì§ì› ì„ íƒ</label>
                            <select id="analysis-member-select" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="">--- ì§ì›/ì•Œë°” ì„ íƒ ---</option>
                            </select>
                        </div>
                        <div id="analysis-personal-stats-container" class="mt-4 p-4 bg-white rounded-lg border min-h-[150px]">
                            <p class="text-center text-gray-500">í†µê³„ë¥¼ ë³´ë ¤ë©´ ìœ„ì—ì„œ ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
    </div>
    
    <div id="modals-container-auth"></div>
    <div id="modals-container-simulation"></div>
    <div id="modals-container-confirm"></div>
    <div id="modals-container-history"></div>
    <div id="modals-container-form"></div>
    <script>
        // 1. ì™¸ë¶€ HTML ì»´í¬ë„ŒíŠ¸ ë¡œë”
        async function loadComponent(url, containerId) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const html = await response.text();
                document.getElementById(containerId).innerHTML = html;
            } catch (error) {
                console.error("ì»´í¬ë„ŒíŠ¸ ë¡œë”© ì‹¤íŒ¨:", error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                const toast = document.createElement('div');
                toast.className = 'toast show bg-red-500 p-3 rounded-lg shadow-xl text-white';
                toast.textContent = `í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ(${url})ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.`;
                document.getElementById('toast-container').prepend(toast);
            }
        }

        // 2. ì•± ì‹œì‘ (ìˆœì°¨ ì‹¤í–‰ ë³´ì¥)
        async function initApp() {
            // (1) ëª¨ë‹¬ HTML íŒŒì¼ë“¤ì„ ë¨¼ì € ë¶ˆëŸ¬ì™€ì„œ DOMì— ì‚½ì…í•©ë‹ˆë‹¤.
            // âœ… [ìˆ˜ì •] ëª¨ë“  ë¶„ë¦¬ëœ ëª¨ë‹¬ íŒŒì¼ì„ ë³‘ë ¬ë¡œ ë¡œë“œ
            await Promise.all([
                loadComponent('components/modals-auth.html', 'modals-container-auth'),
                loadComponent('components/modals-simulation.html', 'modals-container-simulation'),
                loadComponent('components/modals-confirm.html', 'modals-container-confirm'),
                loadComponent('components/modals-history.html', 'modals-container-history'),
                loadComponent('components/modals-form.html', 'modals-container-form')
            ]);

            // (2) ëª¨ë‹¬ì´ ì¤€ë¹„ëœ í›„ ë©”ì¸ ì•± ë¡œì§(app.js)ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
            try {
                await import('./js/app.js');
            } catch (e) {
                console.error("ë©”ì¸ ì•± ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹¤íŒ¨:", e);
            }
        }

        initApp();
    </script>
</body>
</html>